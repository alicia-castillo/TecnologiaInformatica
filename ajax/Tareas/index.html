<!doctype html>
<html lang="en">
  <head>
    <title>Tarea modificacion</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
</head>
  <body>
    <nav class="navbar navbar-light bg-info">
        <a class="navbar-brand" href="#">
            <img src="img/caret.jpg" width="30" height="30" class="d-inline-block align-top" alt="">
            <h3 class="text-light">Tecnolog&iacute;as Inform&aacute;ticas</h3>
        </a>
        </nav>

        <div class="container mrl-5 mt-3">
                <form action="">
                    <div class="form-group">
                     <div class="row">
                        <label for="">Nombre: </label>
                        <input type="text" name="" id="nombre" class="form-control" placeholder="">
                     </div>
                     <div class="row">
                        <label for="">Clave: </label>
                        <input type="text" name="" id="clave" class="form-control" placeholder="">
                     </div>
                    </div>
                    <button type="button" id="add" class="btn btn-info form-control">Agregar</button>
                </form>
                <div class="clear"></div>
    <div>
        <h5 class="text-success"> Lista de Alumnos </h5>
        <ul id="lista-alumnos" class="list-group">

        </ul>
    </div>

</div>
        </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

  
          
  </body>

  <script>
        //cunado el documento este listo y todos los objetos 
        $(document).ready( function(){
            //Una vez que este listo el documento obtendremos la lista de alumnos y la mostraremos.
            getAlumnos();
            //Programacion del boton act para obtener datos del input.
            $("#add").on("click", function(event){
                console.log(event);
                var alumno = { }; //Creacion de objeto con la info necesaria.
                alumno.nombre = $("#nombre").val();
                alumno.clave = $("#clave").val();
                //Invocamos a la funcion para llamadas post y mandamos el obeto.
                sendPOSTRequest(alumno);
            });
        });
        function getAlumnos(){
            //LLamada GET para obtener los alumnos
            //Se muestra resultado con una lista en HTML
            //Se utiliza un ciclo for y se genera el codigo HTML
            //Usando Jquery se coloca el HTML en la lista.
            $.get("http://localhost:3000/alumnos", function(data){
                var listHTML = "";
                console.log(data);
                data.forEach(alumno => {
                    listHTML += "<li class='list-group-item'>" + 
                    " <button type='button' class='delete btn btn-danger btn-sm' data-clave='"+ alumno.clave +"'> <i class='fas fa-trash-alt'></i>delete</i> </button>" + 
                    "<a href='modificar.html?="+ alumno.clave +"' <button type='button' class='modificar btn btn-warning btn-sm' data-clave='"+ alumno.clave +"'> <i class='far fa-edit'></i>modificar</i> </button></a>"
                    +" ♥ Clave : " + alumno.clave + " | Nombre: " + alumno.nombre +  " ♥</li>";
                });
                $("#lista-alumnos").html(listHTML);
                //Programacion para los botones delete
                $(".delete").on("click", (event) =>{
                    console.log("Button delete");
                    console.log(event.target);
                    sendDELETERequest({ "clave" : event.target.dataset["clave"] });
                });

                $('.modificar').on('click', (event)=>{
                    var idUsuario = $(this).attr('clave');
                console.log("Modificando usuario: " + idUsuario);
                console.log("Boton modificar hii", event.target);
                sendPUTRequest({"clave" : event.target.dataset["clave"]});
});
            });
        }
        function sendPOSTRequest(body_object){
            //Llamada post al backend usando jquery.
            
            $.post("http://localhost:3000/alumnos", body_object , 
            function(){
                alert("Alumno guardado.");
                //Actualizamos la lista html para ver los cambios.
                getAlumnos();
                $("#nombre").val("");
                $("#clave").val("");
            });
        }
        function sendDELETERequest(body_object) {
            //Llamada delete al backend por medio de jquery
            $.ajax({
                method: "DELETE",
                url: "http://localhost:3000/alumnos",
                data: body_object
                })
                .done(function( msg ) {
                    alert( "Alumno eliminado: " + body_object.clave );
                })
                .fail(function(msg){
                    alert("Error al eliminar alumno: " + body_object.clave)
                }); 
                getAlumnos();
        }
    </script>
</html>